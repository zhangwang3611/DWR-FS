# DWR-FS (Daily-and-Weekly-Report-Filing-System)

## 项目介绍
DWR-FS是一个简单的日报周报填报管理系统，用于帮助团队成员提交和管理日常工作报告，以及管理员查看和统计报告数据。

## 项目结构

```
DWR-FS/
├── backend/            # 后端代码
│   └── server.js       # 后端服务器代码
├── bin/                # 启动脚本
│   ├── start.bat       # Windows启动脚本
│   ├── start.sh        # Linux/Mac启动脚本
│   └── stop.bat        # Windows停止脚本
├── config/             # 配置文件
│   ├── backend-config.js # 后端配置
│   └── frontend-config.js # 前端配置
├── data/               # 数据文件
│   └── data.json       # 初始数据存储文件
├── docs/               # 文档文件
│   └── README.md       # 项目说明文档
├── frontend/           # 前端代码
│   ├── pages/          # 页面文件
│   │   ├── index.html  # 项目入口页面
│   │   ├── member.html # 成员报告填写页面
│   │   └── admin.html  # 管理员管理页面
│   ├── scripts/        # JavaScript文件
│   │   └── script.js   # 核心JavaScript功能实现
│   └── styles/         # 样式文件
│       └── style.css   # 页面样式文件
└── index.html          # 项目入口文件（根目录）
```

## 文件功能说明

### 根目录文件
- **index.html**: 项目入口文件，提供成员和管理员两个入口

### 后端文件
- **backend/server.js**: 后端服务器代码，提供数据存储和API接口

### 配置文件
- **config/backend-config.js**: 后端配置文件，包含服务器端口、IP地址和数据文件路径等配置
- **config/frontend-config.js**: 前端配置文件，包含API基础URL和管理员密码等配置

### 前端文件
- **frontend/pages/member.html**: 成员页面，用于填写和查看日报周报
- **frontend/pages/admin.html**: 管理员页面，用于查看数据、设置模板、管理项目和成员
- **frontend/scripts/script.js**: 核心JavaScript文件，实现所有功能逻辑
- **frontend/styles/style.css**: 页面样式文件，定义系统的视觉效果

### 数据文件
- **data/data.json**: 数据存储文件，包含项目、成员和报告数据

### 脚本文件
- **bin/start.bat**: Windows系统启动脚本，用于启动后端服务器并打开浏览器
- **bin/start.sh**: Linux/Mac系统启动脚本，用于启动后端服务器并打开浏览器
- **bin/stop.bat**: Windows系统停止脚本，用于停止后端服务器

## 功能模块

### 1. 成员功能

#### 报告填写
- 日报填写：包含今日进展、明日计划
- 周报填写：包含本周完成工作、下周工作计划
- 支持多项目多成员关联
- 支持完成进度填写（1-100%）
- 支持动态添加/删除内容项

#### 报告管理
- 查看历史报告记录
- 按类型（日报/周报）和日期筛选历史记录
- 分页查看历史报告

#### 便捷功能
- 加载昨日报告内容，提高填写效率
- 自动保存草稿功能
- 表单验证确保必填项完整

### 2. 管理员功能

#### 数据查看与报告生成
- 查看指定日期的日报或周报数据
- 生成格式化的报告文件
- 查看未填写日志的成员名单

#### 模板设置
- 自定义日报模板
- 自定义周报模板
- 模板支持变量替换（如{date}、{todayProgress}等）

#### 项目管理
- 添加新项目
- 删除现有项目
- 查看所有项目列表

#### 成员管理
- 添加新成员
- 删除现有成员
- 查看所有成员列表

## 技术实现

### 前端技术
- HTML5：页面结构和表单
- CSS3：页面样式和布局（支持响应式设计）
- JavaScript (ES6+)：交互逻辑和数据处理

### 后端技术
- Node.js：后端服务器环境
- HTTP模块：构建RESTful API接口
- 文件系统模块：数据持久化存储

### 数据存储
- **客户端存储**：使用LocalStorage/SessionStorage进行客户端临时数据存储
- **服务器存储**：通过JSON文件（data.json）进行数据持久化
- **数据结构**：支持项目、成员、报告等数据的结构化存储

### 配置系统

#### 前端配置（config/frontend-config.js）
```javascript
// 前端配置文件
const CONFIG = {
    // API基础URL
    API_BASE_URL: 'http://192.168.53.2:10086/api/data/',
    // 管理员密码
    ADMIN_PASSWORD: '1'
};
```

#### 后端配置（config/backend-config.js）
```javascript
// 后端配置文件
module.exports = {
    // 服务器端口
    PORT: 10086,
    // 数据文件路径
    DATA_FILE: '../data/data.json',
    // 服务器IP地址（用于显示日志）
    SERVER_IP: '192.168.53.2'
};
```

### API接口

#### 基础API
- `GET /api/data`：获取所有数据
- `POST /api/data`：保存所有数据

#### 数据项API
- `GET /api/data/:key`：获取特定数据项
- `POST /api/data/:key`：保存特定数据项

#### API特性
- **版本控制**：支持数据版本冲突检测
- **CORS支持**：允许跨域请求
- **JSON格式**：使用JSON格式传输数据

### 核心功能实现

#### 1. 用户认证与权限控制
- **成员登录**：通过工号或姓名匹配身份
  - 精确工号匹配
  - 精确姓名匹配
  - 姓名包含匹配
  - 姓名首字母匹配
- **管理员登录**：通过密码验证身份（默认密码：1）
- **会话管理**：使用sessionStorage保持登录状态

#### 2. 数据版本控制
- **冲突检测**：实现数据版本冲突检测机制
- **自动重试**：支持自动重试机制（最多3次）
- **数据一致性**：确保并发操作下的数据一致性和完整性

#### 3. 自定义组件
- **多选择成员下拉框**：支持选择多个成员，以标签形式展示
- **动态内容项管理**：支持添加/删除报告内容项
- **模态窗口组件**：用于登录、确认和信息展示
- **标签页组件**：用于管理员页面的功能分类

#### 4. 报告生成
- **按项目分类**：支持按项目分类组织报告内容
- **进度计算**：自动计算完成进度状态
- **复制功能**：支持复制到剪贴板功能
- **格式美化**：生成格式化的报告内容

#### 5. 日志成员信息处理

##### 存储结构
每条日志信息（今日进展、明日计划、本周完成工作、下周工作计划）都包含独立的成员信息，存储结构如下：
```javascript
{
  "project": "项目名称",
  "content": "工作内容",
  "members": ["004757", "005724"], // 存储成员工号数组
  "progress": 80 // 仅非计划项包含进度信息
}
```

##### 成员选择实现
- **自定义下拉框**：在member.html页面中，每条日志条目使用自定义下拉框进行成员选择
- **默认选择**：自动默认选择当前用户
- **多成员选择**：支持选择多个成员，以标签形式展示已选项
- **数据存储**：选择的成员工号存储在隐藏输入框中

##### 成员信息处理流程
1. **加载成员数据**：通过`loadMembersToDropdown`函数从LocalStorage加载成员列表
2. **成员选择**：用户通过自定义下拉框选择成员，通过`handleMemberSelect`函数处理选择逻辑
3. **数据存储**：选择的成员工号数组通过`getContentItems`函数收集，存储到报告数据中
4. **数据展示**：显示报告时，通过`getMemberNameById`函数将工号转换为姓名

##### 成员信息匹配策略
1. **精确匹配**：优先通过工号或姓名精确匹配成员
2. **包含匹配**：如果精确匹配失败，尝试使用包含匹配
3. **首字母匹配**：如果包含匹配失败，尝试使用首字母匹配
4. **容错处理**：如果所有匹配都失败，显示工号作为后备

##### 关键函数
- `loadMembersToDropdown`：加载成员数据到下拉框
- `initCustomMemberDropdown`：初始化自定义成员下拉框
- `handleMemberSelect`：处理成员选择逻辑
- `renderSelectedTags`：渲染选中的成员标签
- `getContentItems`：收集包含成员信息的日志条目
- `getMemberNameById`：将工号转换为成员姓名
- `fillContentItems`：在编辑报告时填充成员信息

## 使用方法

### 一键启动（推荐）

#### Windows系统
1. 双击运行项目 `bin` 目录下的 `start.bat` 文件
2. 脚本将自动启动后端服务器并打开浏览器
3. 直接在浏览器中使用系统

#### Linux/Mac系统
1. 打开终端，进入项目根目录
2. 执行命令：`chmod +x bin/start.sh`（仅首次需要）
3. 执行命令：`./bin/start.sh`
4. 脚本将自动启动后端服务器并打开浏览器

### 手动启动

#### 启动后端服务器
1. 打开终端，进入项目根目录
2. 进入backend目录：`cd backend`
3. 启动服务器：`node server.js`
4. 服务器将在 http://192.168.53.2:10086 启动

#### 停止后端服务器
1. Windows系统：双击运行项目 `bin` 目录下的 `stop.bat` 文件
2. Linux/Mac系统：在终端中按 Ctrl+C 停止服务器进程

#### 访问应用
1. 打开浏览器
2. 访问地址：http://192.168.53.2:10086

### 成员使用流程

1. 在浏览器中点击"成员入口"按钮
2. 输入工号或姓名，点击"确认"
3. 在member.html页面选择报告类型（日报/周报）
4. 填写报告内容：
   - 选择项目和成员
   - 输入工作内容
   - 填写完成进度（仅今日进展/本周完成工作）
   - 点击"+"添加更多内容项
5. 点击"保存报告"按钮
6. 可点击"历史日志"查看以往报告

### 管理员使用流程

1. 在浏览器中点击"管理员入口"按钮
2. 输入密码（默认：1），点击"登录"
3. 在admin.html页面选择需要的功能：
   - 数据查看：选择报告类型和日期，查看报告数据
   - 模板设置：编辑日报和周报模板
   - 项目管理：添加或删除项目
   - 成员管理：添加或删除成员

## 注意事项

1. **管理员密码**：默认管理员密码为"1"，建议首次登录后修改
2. **报告填写**：报告内容支持动态添加，但至少需要填写一项
3. **自动保存**：系统会自动保存草稿，刷新页面后不会丢失已填写内容
4. **复制功能**：生成的报告可以直接复制到剪贴板，方便粘贴到其他平台
5. **成员登录**：支持多种匹配方式：
   - 工号精确匹配
   - 姓名精确匹配
   - 姓名包含匹配
   - 姓名首字母匹配
6. **数据存储**：数据保存在服务器的data.json文件中，定期备份该文件以防止数据丢失
7. **浏览器兼容性**：建议使用Chrome、Firefox、Edge等现代浏览器访问系统
8. **服务器配置**：可以通过config目录下的配置文件修改服务器端口、IP地址等配置
9. **网络环境**：系统需要在网络环境下运行，确保客户端可以访问服务器IP地址
10. **并发操作**：系统支持并发操作，通过版本控制确保数据一致性

## 更新日志

### v1.0
- 初始版本发布
- 实现成员报告填写和查看功能
- 实现管理员数据管理和模板设置功能
- 支持日报和周报两种报告类型
