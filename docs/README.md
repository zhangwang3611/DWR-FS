# DWR-FS (Daily-and-Weekly-Report-Filing-System)

## 项目介绍
DWR-FS是一个简单的日报周报填报管理系统，用于帮助团队成员提交和管理日常工作报告，以及管理员查看和统计报告数据。

## 项目结构

```
DWR-FS/
├── backend/            # 后端代码
│   └── server.js       # 后端服务器代码
├── data/               # 数据文件
│   └── data.json       # 初始数据存储文件
├── docs/               # 文档文件
│   └── README.md       # 项目说明文档
└── frontend/           # 前端代码
    ├── pages/          # 页面文件
    │   ├── index.html  # 项目入口页面
    │   ├── member.html # 成员报告填写页面
    │   └── admin.html  # 管理员管理页面
    ├── scripts/        # JavaScript文件
    │   ├── script.js       # 核心JavaScript功能实现
    │   └── migrate_data.js # 数据迁移脚本
    └── styles/         # 样式文件
        └── style.css   # 页面样式文件
```

## 文件功能说明

- **frontend/pages/index.html**: 项目入口页面，提供成员和管理员两个入口
- **frontend/pages/member.html**: 成员页面，用于填写和查看日报周报
- **frontend/pages/admin.html**: 管理员页面，用于查看数据、设置模板、管理项目和成员
- **frontend/scripts/script.js**: 核心JavaScript文件，实现所有功能逻辑
- **frontend/styles/style.css**: 页面样式文件，定义系统的视觉效果
- **data/data.json**: 初始数据文件，包含项目、成员和报告的示例数据
- **frontend/scripts/migrate_data.js**: 数据迁移脚本，用于更新数据结构
- **backend/server.js**: 后端服务器代码，提供数据存储和API接口

## 功能模块

### 1. 成员功能

#### 报告填写
- 日报填写：包含今日进展、明日计划
- 周报填写：包含本周完成工作、下周工作计划
- 支持多项目多成员关联
- 支持完成进度填写（1-100%）
- 支持动态添加/删除内容项

#### 报告管理
- 查看历史报告记录
- 按类型（日报/周报）和日期筛选历史记录
- 分页查看历史报告

#### 便捷功能
- 加载昨日报告内容，提高填写效率
- 自动保存草稿功能
- 表单验证确保必填项完整

### 2. 管理员功能

#### 数据查看与报告生成
- 查看指定日期的日报或周报数据
- 生成格式化的报告文件
- 查看未填写日志的成员名单

#### 模板设置
- 自定义日报模板
- 自定义周报模板
- 模板支持变量替换（如{date}、{todayProgress}等）

#### 项目管理
- 添加新项目
- 删除现有项目
- 查看所有项目列表

#### 成员管理
- 添加新成员
- 删除现有成员
- 查看所有成员列表

## 技术实现

### 前端技术
- HTML5：页面结构和表单
- CSS3：页面样式和布局
- JavaScript (ES6+)：交互逻辑和数据处理

### 数据存储
- LocalStorage/SessionStorage：客户端临时存储
- 后端JSON数据存储：通过server.js提供的数据接口

### 核心功能实现

#### 1. 用户认证与权限控制
- 成员登录：通过工号或姓名匹配身份
- 管理员登录：通过密码验证身份（默认密码：1）
- 会话管理：使用sessionStorage保持登录状态

#### 2. 数据版本控制
- 实现数据版本冲突检测
- 支持自动重试机制（最多3次）
- 确保数据一致性和完整性

#### 3. 自定义组件
- **多选择成员下拉框**：支持选择多个成员，以标签形式展示
- 动态内容项管理：支持添加/删除报告内容项
- 模态窗口组件：用于登录、确认和信息展示

#### 4. 报告生成
- 支持按项目分类组织报告内容
- 自动计算完成进度状态
- 支持复制到剪贴板功能

#### 5. 日志成员信息处理

#### 存储结构
每条日志信息（今日进展、明日计划、本周完成工作、下周工作计划）都包含独立的成员信息，存储结构如下：
```javascript
{
  "project": "项目名称",
  "content": "工作内容",
  "members": ["004757", "005724"], // 存储成员工号数组
  "progress": 80 // 仅非计划项包含进度信息
}
```

#### 成员选择实现
- **自定义下拉框**：在member.html页面中，每条日志条目使用自定义下拉框进行成员选择
- **默认选择**：自动默认选择当前用户
- **多成员选择**：支持选择多个成员，以标签形式展示已选项
- **数据存储**：选择的成员工号存储在隐藏输入框中

#### 成员信息处理流程
1. **加载成员数据**：通过`loadMembersToDropdown`函数从LocalStorage加载成员列表
2. **成员选择**：用户通过自定义下拉框选择成员，通过`handleMemberSelect`函数处理选择逻辑
3. **数据存储**：选择的成员工号数组通过`getContentItems`函数收集，存储到报告数据中
4. **数据展示**：显示报告时，通过`getMemberNameById`函数将工号转换为姓名

#### 成员信息匹配策略
1. **精确匹配**：优先通过工号或姓名精确匹配成员
2. **包含匹配**：如果精确匹配失败，尝试使用包含匹配
3. **首字母匹配**：如果包含匹配失败，尝试使用首字母匹配
4. **容错处理**：如果所有匹配都失败，显示工号作为后备

#### 关键函数
- `loadMembersToDropdown`：加载成员数据到下拉框
- `initCustomMemberDropdown`：初始化自定义成员下拉框
- `handleMemberSelect`：处理成员选择逻辑
- `renderSelectedTags`：渲染选中的成员标签
- `getContentItems`：收集包含成员信息的日志条目
- `getMemberNameById`：将工号转换为成员姓名
- `fillContentItems`：在编辑报告时填充成员信息

## 使用方法

### 成员使用流程

1. 打开index.html页面
2. 点击"成员入口"按钮
3. 输入工号或姓名，点击"确认"
4. 在member.html页面选择报告类型（日报/周报）
5. 填写报告内容：
   - 选择项目和成员
   - 输入工作内容
   - 填写完成进度（仅今日进展/本周完成工作）
   - 点击"+"添加更多内容项
6. 点击"保存报告"按钮
7. 可点击"历史日志"查看以往报告

### 管理员使用流程

1. 打开index.html页面
2. 点击"管理员入口"按钮
3. 输入密码（默认：1），点击"登录"
4. 在admin.html页面选择需要的功能：
   - 数据查看：选择报告类型和日期，查看报告数据
   - 模板设置：编辑日报和周报模板
   - 项目管理：添加或删除项目
   - 成员管理：添加或删除成员

## 注意事项

1. 默认管理员密码为"1"，建议首次登录后修改
2. 报告内容支持动态添加，但至少需要填写一项
3. 系统会自动保存草稿，刷新页面后不会丢失已填写内容
4. 生成的报告可以直接复制到剪贴板，方便粘贴到其他平台
5. 成员登录支持多种匹配方式：工号精确匹配、姓名精确匹配、姓名包含匹配

## 更新日志

### v1.0
- 初始版本发布
- 实现成员报告填写和查看功能
- 实现管理员数据管理和模板设置功能
- 支持日报和周报两种报告类型
